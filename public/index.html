<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>DevCenterX</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css?v=1.1">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    (function() {
      const user = localStorage.getItem('devcenter_user');
      const sessionData = localStorage.getItem('devcenter_session');
      window.isLoggedIn = !!user;
      window.currentPath = window.location.pathname;
      
      // Cargar datos de sesión completa
      if (window.isLoggedIn && sessionData) {
        try {
          window.currentSession = JSON.parse(sessionData);
        } catch(e) {
          window.currentSession = {
            usuario: user,
            email: localStorage.getItem('devcenter_email'),
            id: localStorage.getItem('devcenter_user_id')
          };
        }
      }
      
      if (!window.isLoggedIn) {
        window.location.href = "/new.html";
      } else {
        console.log('Usuario detectado desde localStorage:', user);
        if (window.currentSession) {
          console.log('Sesión completa cargada:', window.currentSession);
        }
      }
    })();
  </script>
</head>
<body>
  <!-- ==================== LOADING SCREEN ==================== -->
  <div id="loadingScreen" class="loading-screen" style="display: none;">
    <div class="loading-content">
      <div class="loading-animation-elegant">
        <div class="loading-orb"></div>
        <div class="loading-ring"></div>
        <div class="loading-ring loading-ring-2"></div>
        <div class="loading-ring loading-ring-3"></div>
        <div class="loading-particles">
          <span></span><span></span><span></span><span></span>
          <span></span><span></span><span></span><span></span>
        </div>
      </div>
      <p class="loading-text">Preparando tu espacio de trabajo...</p>
      <div class="loading-progress">
        <div class="loading-progress-bar"></div>
      </div>
    </div>
  </div>

  <!-- ==================== TERMS MODAL (#terms) ==================== -->
  <div id="termsPage" class="legal-modal-overlay" style="display: none;">
    <div class="legal-modal">
      <div class="legal-modal-header">
        <div class="legal-modal-title">
          <div class="legal-icon-wrapper">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14 2 14 8 20 8"/>
            </svg>
          </div>
          <div>
            <h1>Terminos de Servicio</h1>
            <span class="legal-date">Actualizado: Diciembre 2024</span>
          </div>
        </div>
        <button class="legal-close-btn" onclick="window.closeLegalModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="legal-modal-body">
        <div class="legal-section">
          <div class="legal-section-header">
            <span class="legal-section-number">01</span>
            <h2>Aceptacion de los Terminos</h2>
          </div>
          <p>Al acceder y utilizar DevCenterX, aceptas estar sujeto a estos Terminos de Servicio. Si no estas de acuerdo con alguna parte de estos terminos, no podras acceder al servicio.</p>
        </div>
        <div class="legal-section">
          <div class="legal-section-header">
            <span class="legal-section-number">02</span>
            <h2>Descripcion del Servicio</h2>
          </div>
          <p>DevCenterX es una plataforma de desarrollo web potenciada por inteligencia artificial.</p>
          <div class="legal-features">
            <div class="legal-feature"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>Generacion automatica de codigo</div>
            <div class="legal-feature"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>Editor en tiempo real</div>
            <div class="legal-feature"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>Vista previa responsiva</div>
            <div class="legal-feature"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>Almacenamiento en la nube</div>
          </div>
        </div>
        <div class="legal-section">
          <div class="legal-section-header">
            <span class="legal-section-number">03</span>
            <h2>Registro y Cuenta</h2>
          </div>
          <p>Para utilizar ciertas funcionalidades, deberas crear una cuenta y seras responsable de mantener la seguridad de tu contrasena y todas las actividades bajo tu cuenta.</p>
        </div>
        <div class="legal-section">
          <div class="legal-section-header">
            <span class="legal-section-number">04</span>
            <h2>Uso Aceptable</h2>
          </div>
          <p>Te comprometes a no utilizar DevCenterX para violar leyes, infringir derechos de propiedad intelectual, distribuir malware o realizar actividades fraudulentas.</p>
        </div>
        <div class="legal-section">
          <div class="legal-section-header">
            <span class="legal-section-number">05</span>
            <h2>Propiedad Intelectual</h2>
          </div>
          <p>El codigo generado para tus proyectos es de tu propiedad. La plataforma y su tecnologia son propiedad de DevCenterX.</p>
        </div>
        <div class="legal-section">
          <div class="legal-section-header">
            <span class="legal-section-number">06</span>
            <h2>Contacto</h2>
          </div>
          <p>Si tienes preguntas, puedes contactarnos a traves de la seccion de contacto en nuestra plataforma.</p>
        </div>
      </div>
      <div class="legal-modal-footer">
        <button class="legal-accept-btn" onclick="window.closeLegalModal()">Entendido</button>
      </div>
    </div>
  </div>

  <!-- ==================== PRIVACY MODAL (#privacy) ==================== -->
  <div id="privacyPage" class="legal-modal-overlay" style="display: none;">
    <div class="legal-modal">
      <div class="legal-modal-header">
        <div class="legal-modal-title">
          <div class="legal-icon-wrapper privacy">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>
          </div>
          <div>
            <h1>Politica de Privacidad</h1>
            <span class="legal-date">Actualizado: Diciembre 2024</span>
          </div>
        </div>
        <button class="legal-close-btn" onclick="window.closeLegalModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="legal-modal-body">
        <div class="legal-section">
          <div class="legal-section-header">
            <span class="legal-section-number">01</span>
            <h2>Informacion que Recopilamos</h2>
          </div>
          <div class="legal-info-grid">
            <div class="legal-info-item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
              <div><strong>Cuenta</strong><span>Email y usuario</span></div>
            </div>
            <div class="legal-info-item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/><polyline points="13 2 13 9 20 9"/></svg>
              <div><strong>Proyectos</strong><span>Tu codigo</span></div>
            </div>
            <div class="legal-info-item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
              <div><strong>Uso</strong><span>Interacciones</span></div>
            </div>
            <div class="legal-info-item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
              <div><strong>Dispositivo</strong><span>Navegador, OS</span></div>
            </div>
          </div>
        </div>
        <div class="legal-section">
          <div class="legal-section-header">
            <span class="legal-section-number">02</span>
            <h2>Como Usamos tu Informacion</h2>
          </div>
          <p>Utilizamos la informacion para proporcionar el servicio, mejorar tu experiencia, comunicarnos contigo y detectar fraudes.</p>
        </div>
        <div class="legal-section">
          <div class="legal-section-header">
            <span class="legal-section-number">03</span>
            <h2>Seguridad</h2>
          </div>
          <p>Tus datos se almacenan de forma segura con encriptacion. Implementamos medidas tecnicas y organizativas para proteger tu informacion.</p>
        </div>
        <div class="legal-section">
          <div class="legal-section-header">
            <span class="legal-section-number">04</span>
            <h2>Tus Derechos</h2>
          </div>
          <div class="legal-features">
            <div class="legal-feature"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>Acceder a tus datos</div>
            <div class="legal-feature"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>Corregir informacion</div>
            <div class="legal-feature"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>Solicitar eliminacion</div>
            <div class="legal-feature"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>Exportar proyectos</div>
          </div>
        </div>
        <div class="legal-section">
          <div class="legal-section-header">
            <span class="legal-section-number">05</span>
            <h2>Cookies</h2>
          </div>
          <p>Utilizamos cookies para mejorar tu experiencia y recordar tus preferencias.</p>
        </div>
      </div>
      <div class="legal-modal-footer">
        <button class="legal-accept-btn" onclick="window.closeLegalModal()">Entendido</button>
      </div>
    </div>
  </div>

  <!-- ==================== MAIN APP ==================== -->
  <!-- Botones cuando el sidebar está cerrado -->
  <div class="sidebar-collapsed-controls" id="sidebarCollapsedControls">
    <button class="sidebar-toggle-open" id="sidebarOpenBtn" title="Abrir panel">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
        <line x1="9" y1="3" x2="9" y2="21"/>
      </svg>
    </button>
    <button class="options-btn" id="optionsBtn" title="Opciones">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
        <circle cx="12" cy="7" r="4"/>
      </svg>
    </button>
  </div>

  <!-- Menú de opciones (cuando sidebar está cerrado) -->
  <div class="options-menu" id="optionsMenu">
    <div class="logo-menu-item" id="optionsMenuAccount">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
        <circle cx="12" cy="7" r="4"/>
      </svg>
      <span>Account</span>
    </div>
    <div class="logo-menu-item logo-menu-theme" id="optionsMenuTheme">
      <div class="logo-menu-theme-inner">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
        <span>Theme</span>
      </div>
      <div class="theme-icons">
        <button class="theme-icon" data-theme="dark" title="Modo oscuro">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>
        <button class="theme-icon" data-theme="light" title="Modo claro">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
          </svg>
        </button>
      </div>
    </div>
    <div class="logo-menu-item" id="optionsMenuHelp">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
      </svg>
      Help
      <svg class="menu-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="9 18 15 12 9 6"/>
      </svg>
    </div>
    <div class="logo-menu-divider"></div>
    <div class="logo-menu-item" id="optionsMenuLogout">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
        <polyline points="16 17 21 12 16 7"/>
        <line x1="21" y1="12" x2="9" y2="12"/>
      </svg>
      Log out
    </div>
  </div>

  <!-- Sidebar -->
  <aside class="sidebar" id="mainSidebar">
    <div class="sidebar-header">
      <button class="logo logo-btn" id="logoBtn">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M12 1v6m0 6v6m10-11h-6m-6 0H1m18.36 7.36l-4.24-4.24m-6 0L4.64 19.36m14.72 0l-4.24-4.24m-6 0L4.64 4.64"/>
        </svg>
        <svg class="logo-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="6 9 12 15 18 9"/>
        </svg>
      </button>
      <button class="search-btn" title="Cerrar panel">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
          <line x1="15" y1="9" x2="9" y2="9"/>
        </svg>
      </button>
    </div>

    <!-- Menú desplegable del logo -->
    <div class="logo-menu" id="logoMenu">
      <div class="logo-menu-item" id="menuAccount">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
          <circle cx="12" cy="7" r="4"/>
        </svg>
        <span id="accountText">Account</span>
      </div>
      <div class="logo-menu-item logo-menu-theme" id="menuTheme">
        <div class="menu-theme-inner">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
          <span>Theme</span>
        </div>
        <div class="theme-icons">
          <button class="theme-icon" data-theme="dark" title="Modo oscuro">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
            </svg>
          </button>
          <button class="theme-icon" data-theme="light" title="Modo claro">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="5"/>
              <line x1="12" y1="1" x2="12" y2="3"/>
              <line x1="12" y1="21" x2="12" y2="23"/>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
              <line x1="1" y1="12" x2="3" y2="12"/>
              <line x1="21" y1="12" x2="23" y2="12"/>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="logo-menu-item" id="menuHelp">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
          <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
        </svg>
        Help
        <svg class="menu-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"/>
        </svg>
      </div>
      <div class="logo-menu-divider"></div>
      <div class="logo-menu-item" id="menuLogout">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
          <polyline points="16 17 21 12 16 7"/>
          <line x1="21" y1="12" x2="9" y2="12"/>
        </svg>
        Log out
      </div>
    </div>

    <button class="create-btn" id="mainCreateBtn">
      <span>+</span> Create App
    </button>

    <nav class="nav-menu">
      <a href="#" class="nav-item active" data-section="home" data-tooltip="Home">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
          <polyline points="9 22 9 12 15 12 15 22"/>
        </svg>
        Home
      </a>
      <a href="#" class="nav-item" data-section="apps" data-tooltip="Apps">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="7"/>
          <rect x="14" y="3" width="7" height="7"/>
          <rect x="14" y="14" width="7" height="7"/>
          <rect x="3" y="14" width="7" height="7"/>
        </svg>
        Apps
      </a>
      <a href="#" class="nav-item" data-section="published" data-tooltip="Published apps">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
        Published apps
      </a>
      <a href="#" class="nav-item" data-section="usage" data-tooltip="Usage">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="1" x2="12" y2="23"/>
          <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
        </svg>
        Usage
      </a>
      <a href="#" class="nav-item" data-section="settings" data-tooltip="Ajustes">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
        Ajustes
      </a>
    </nav>

    <div class="sidebar-footer">
      <div class="user-section">
        <div class="plan-info">
          <div class="plan-title" id="userPlanTitle">Starter Plan</div>
          <div class="plan-stats">
            <div class="stat">
              <span class="stat-label">Free Apps</span>
              <span class="stat-value" id="userAppsCount">0/10 created</span>
            </div>
            <div class="stat">
              <span class="stat-label">Agent Usage</span>
              <span class="stat-value" id="userAgentUsage">0% used</span>
            </div>
          </div>
        </div>
        <button class="upgrade-btn" id="upgradeAgentBtn">
          <span>+</span> Upgrade Agent
        </button>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Home Section -->
    <section id="home-section" class="content-section active">
      <div class="home-hero">
        <div class="greeting greeting-centered">
          <h1 id="greetingText">Hi <span class="username" id="usernameSpan"></span>, what do you want to make?</h1>
        </div>
      </div>

      <div class="home-search">
        <div class="input-wrapper">
          <div class="home-search__main">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            </svg>
            <textarea id="searchBox" rows="3" placeholder="Describe your app idea, '/' for integrations..."></textarea>
          </div>
          <div class="home-search__actions">
            <button class="start-chat-btn" id="startChatBtn">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 2L11 13"/>
                <path d="M22 2L15 22L11 13L2 9L22 2Z"/>
              </svg>
              Start chat
            </button>
          </div>
          
          <!-- Botones de tipo de app dentro del input -->
          <div class="home-search__chips">
            <button class="app-type-compact">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <circle cx="12" cy="12" r="6"/>
                <circle cx="12" cy="12" r="2"/>
              </svg>
              Web app
            </button>
            <button class="app-type-compact">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 3v18h18"/>
                <path d="M18 17V9"/>
                <path d="M13 17V5"/>
                <path d="M8 17v-3"/>
              </svg>
              Data app
            </button>
            <button class="app-type-compact">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21.21 15.89A10 10 0 1 1 8 2.83"/>
                <path d="M22 12A10 10 0 0 0 12 2v10z"/>
              </svg>
              3D Game
            </button>
            <button class="app-type-compact">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="2" y1="12" x2="22" y2="12"/>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
              </svg>
              General
            </button>
            <button class="app-type-compact">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M22 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
              </svg>
              Agents & Automations 
              <span class="beta-badge-compact">Beta</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Sección Promocional (se inserta dinámicamente) -->
      <div id="promotedSection"></div>

      <div class="projects-section projects-section-premium">
        <div class="section-header-premium">
          <div class="section-header-left">
            <div class="section-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7" rx="1"/>
                <rect x="14" y="3" width="7" height="7" rx="1"/>
                <rect x="3" y="14" width="7" height="7" rx="1"/>
                <rect x="14" y="14" width="7" height="7" rx="1"/>
              </svg>
            </div>
            <h2>Your recent Apps</h2>
          </div>
          <button id="createAppHeaderBtn" class="create-app-btn-premium">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <line x1="12" y1="5" x2="12" y2="19"/>
              <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            <span>Create App</span>
          </button>
        </div>
        
        <!-- Proyectos del usuario -->
        <div id="userProjectsSection">
          <div id="userProjectsGrid" class="projects-grid projects-grid-premium"></div>
          
          <!-- Estado vacío cuando no hay proyectos -->
          <div id="userProjectsEmpty" class="empty-state empty-state-premium">
            <div class="empty-state-icon">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <rect x="3" y="3" width="18" height="18" rx="2"/>
                <line x1="9" y1="9" x2="15" y2="9"/>
                <line x1="9" y1="15" x2="15" y2="15"/>
              </svg>
            </div>
            <div class="empty-state-content">
              <h3 id="emptyStateTitle">No tienes apps todavía</h3>
              <p id="emptyStateDescription">Crea tu primera app para empezar</p>
            </div>
            <button id="createFirstAppBtn" class="create-app-btn-premium create-app-btn-large">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                <path d="M2 17l10 5 10-5"/>
                <path d="M2 12l10 5 10-5"/>
              </svg>
              <span id="createFirstAppBtnText">Crear App</span>
            </button>
          </div>
        </div>
        
        <div id="projectsGrid" class="projects-grid">
          <div style="grid-column: 1 / -1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 20px; color: var(--text-secondary);">
            <div class="loading-spinner" style="margin-bottom: 20px;">
              <div class="dot"></div>
              <div class="dot"></div>
              <div class="dot"></div>
            </div>
            <p style="font-size: 16px; font-weight: 500;">Cargando tus proyectos...</p>
          </div>
        </div>

        <!-- Estado vacío -->
        <div id="emptyState" class="empty-state">
          <p>No se encontraron proyectos</p>
        </div>

        <!-- Paginación -->
        <div id="paginationControls" class="pagination-controls">
          <button id="prevPageBtn" class="pagination-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"/>
            </svg>
            Anterior
          </button>
          <span id="pageIndicator" class="page-indicator">Página 1</span>
          <button id="nextPageBtn" class="pagination-btn">
            Siguiente
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Sección de Favoritos (oculta, ahora los favoritos se muestran arriba del grid principal) -->
      <div id="favoritesSection">
        <div id="favoritesGrid" class="projects-grid"></div>
      </div>
    </section>

    <!-- Apps Section -->
    <section id="apps-section" class="content-section">
      <div class="greeting">
        <h1>Proyectos de la Comunidad</h1>
        <!-- Buscador de proyectos -->
        <div class="apps-search-container">
          <svg class="apps-search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
          <input type="text" id="appsSearchInput" placeholder="Buscar proyectos...">
        </div>
      </div>
      <div id="appsGrid" class="projects-grid">
        <!-- Proyectos se cargarán aquí -->
      </div>
    </section>

    <!-- Published Apps Section -->
    <section id="published-section" class="content-section">
      <div class="greeting published-greeting">
        <h1>Tus Aplicaciones Publicadas</h1>
      </div>
      
      <!-- Mensaje de login requerido -->
      <div id="publishedLoginRequired">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
          <circle cx="12" cy="7" r="4"/>
        </svg>
        <h2 class="published-login-title">Inicia sesión para ver tus aplicaciones</h2>
        <p class="published-login-desc">Necesitas iniciar sesión para ver y gestionar tus aplicaciones publicadas.</p>
        <button onclick="window.location.href='/Creator/index.html'" class="published-login-btn">Iniciar Sesión</button>
      </div>
      
      <!-- Contenido principal (solo visible cuando está logueado) -->
      <div id="publishedContent">
        <!-- Estadísticas Globales -->
        <div class="stats-overview" id="statsOverview">
          <!-- Estadísticas se cargarán aquí -->
        </div>
        
        <!-- Proyectos Publicados -->
        <div class="published-projects-wrapper">
          <h2 class="published-projects-header">Tus Proyectos</h2>
          <div id="publishedGrid" class="projects-grid">
            <!-- Proyectos publicados se cargarán aquí -->
          </div>
        </div>
        
        <!-- Gráficas -->
        <div class="charts-container">
          <div class="chart-card chart-card-main">
            <div class="chart-header">
              <h3 class="chart-title">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 3v18h18"/>
                  <path d="M18 17V9"/>
                  <path d="M13 17V5"/>
                  <path d="M8 17v-3"/>
                </svg>
                Rendimiento de tus Proyectos
              </h3>
            </div>
            <canvas id="projectsChart"></canvas>
          </div>
          
          <div class="charts-grid">
            <div class="chart-card">
              <div class="chart-header">
                <h3 class="chart-title">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21.21 15.89A10 10 0 1 1 8 2.83"/>
                    <path d="M22 12A10 10 0 0 0 12 2v10z"/>
                  </svg>
                  Distribución
                </h3>
              </div>
              <canvas id="statsDonutChart"></canvas>
            </div>
            <div class="chart-card">
              <div class="chart-header">
                <h3 class="chart-title">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                  </svg>
                  Engagement
                </h3>
              </div>
              <canvas id="engagementChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Usage Section -->
    <section id="usage-section" class="content-section">
      <div class="greeting usage-greeting">
        <h1>Uso del Agente</h1>
        <p class="usage-greeting-subtitle">Monitorea el uso de tus recursos y límites</p>
      </div>
      
      <!-- Mensaje de login requerido -->
      <div id="usageLoginRequired" class="usage-login-required">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
          <circle cx="12" cy="7" r="4"/>
        </svg>
        <h2 class="usage-login-title">Inicia sesión para ver tu uso</h2>
        <p class="usage-login-desc">Necesitas iniciar sesión para ver tus estadísticas de uso.</p>
        <button onclick="window.location.href='/Creator/index.html'" class="usage-login-btn">Iniciar Sesión</button>
      </div>
      
      <!-- Contenido principal (solo visible cuando está logueado) -->
      <div id="usageContent">
        <!-- Estadísticas de Uso -->
        <div class="usage-stats-grid">
          <!-- Tarjeta de Uso del Agente -->
          <div class="usage-card usage-card-agent">
            <div class="usage-card-inner">
              <div class="usage-card-header">
                <div class="usage-card-icon usage-card-icon-agent">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                  </svg>
                </div>
                <div class="usage-card-info">
                  <div class="usage-card-label">Uso del Agente</div>
                  <div class="usage-card-value" id="usageAgentPercent">0%</div>
                </div>
              </div>
              <div class="usage-progress-container">
                <div class="usage-progress-bar">
                  <div id="usageAgentBar" class="usage-progress-fill usage-progress-fill-agent"></div>
                </div>
                <div class="usage-progress-text" id="usageAgentText">Sin uso registrado</div>
              </div>
            </div>
          </div>

          <!-- Tarjeta de Apps Creadas -->
          <div class="usage-card usage-card-apps">
            <div class="usage-card-inner">
              <div class="usage-card-header">
                <div class="usage-card-icon usage-card-icon-apps">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"/>
                    <rect x="14" y="3" width="7" height="7"/>
                    <rect x="14" y="14" width="7" height="7"/>
                    <rect x="3" y="14" width="7" height="7"/>
                  </svg>
                </div>
                <div class="usage-card-info">
                  <div class="usage-card-label">Apps Creadas</div>
                  <div class="usage-card-value">
                    <span id="usageAppsCount">0</span><span class="usage-card-value-small">/10</span>
                  </div>
                </div>
              </div>
              <div class="usage-progress-container">
                <div class="usage-progress-bar usage-progress-bar-apps">
                  <div id="usageAppsBar" class="usage-progress-fill usage-progress-fill-apps"></div>
                </div>
                <div class="usage-progress-text">Límite del plan Starter</div>
              </div>
            </div>
          </div>

          <!-- Tarjeta de Plan Actual (Clickeable) -->
          <div class="usage-card usage-card-plan usage-card-clickable" id="planCard" onclick="togglePlanBenefits()">
            <div class="usage-card-inner">
              <div class="usage-card-header">
                <div class="usage-card-icon usage-card-icon-plan" id="planIconContainer">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <circle cx="12" cy="8" r="7"/>
                    <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/>
                  </svg>
                </div>
                <div class="usage-card-info">
                  <div class="usage-card-label">Plan Actual</div>
                  <div class="usage-card-value" id="usagePlanName">Normal</div>
                </div>
                <div class="usage-card-expand-icon" id="planExpandIcon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"/>
                  </svg>
                </div>
              </div>
              <p class="usage-card-hint">Toca para ver tus beneficios</p>
            </div>
            <!-- Panel de beneficios expandible -->
            <div class="plan-benefits-panel" id="planBenefitsPanel">
              <div class="plan-benefits-header">
                <span class="plan-benefits-title">Beneficios de tu plan</span>
              </div>
              <ul class="plan-benefits-list" id="planBenefitsList">
                <!-- Se llenará dinámicamente -->
              </ul>
            </div>
          </div>
        </div>

        <!-- Información del Plan -->
        <div class="usage-plan-details">
          <h2 class="usage-plan-details-title">Detalles de tu Plan</h2>
          <div class="usage-plan-grid" id="usagePlanGrid">
            <!-- Se llenará dinámicamente con los detalles del plan -->
          </div>
        </div>
      </div>
    </section>

    <!-- Settings Section -->
    <section id="settings-section" class="content-section">
      <div class="greeting settings-greeting">
        <h1>Ajustes</h1>
        <p class="settings-greeting-subtitle">Personaliza tu experiencia en DevCenterX</p>
      </div>
      
      <div class="settings-container">
        <!-- Apariencia -->
        <div class="settings-card">
          <div class="settings-card-header">
            <div class="settings-card-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="5"/>
                <line x1="12" y1="1" x2="12" y2="3"/>
                <line x1="12" y1="21" x2="12" y2="23"/>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                <line x1="1" y1="12" x2="3" y2="12"/>
                <line x1="21" y1="12" x2="23" y2="12"/>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
              </svg>
            </div>
            <div class="settings-card-title">
              <h3>Apariencia</h3>
              <p>Personaliza el aspecto visual de la aplicacion</p>
            </div>
          </div>
          <div class="settings-card-content">
            <div class="settings-option">
              <div class="settings-option-info">
                <span class="settings-option-label">Tema</span>
                <span class="settings-option-desc">Elige entre modo claro u oscuro</span>
              </div>
              <div class="settings-theme-toggle">
                <button class="theme-option" data-theme="dark" id="themeDarkBtn">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                  </svg>
                  Oscuro
                </button>
                <button class="theme-option" data-theme="light" id="themeLightBtn">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"/>
                    <line x1="12" y1="1" x2="12" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="23"/>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line x1="1" y1="12" x2="3" y2="12"/>
                    <line x1="21" y1="12" x2="23" y2="12"/>
                  </svg>
                  Claro
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Notificaciones -->
        <div class="settings-card">
          <div class="settings-card-header">
            <div class="settings-card-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
              </svg>
            </div>
            <div class="settings-card-title">
              <h3>Notificaciones</h3>
              <p>Configura como recibir alertas</p>
            </div>
          </div>
          <div class="settings-card-content">
            <div class="settings-option">
              <div class="settings-option-info">
                <span class="settings-option-label">Notificaciones por email</span>
                <span class="settings-option-desc">Recibe actualizaciones importantes</span>
              </div>
              <label class="settings-switch">
                <input type="checkbox" id="emailNotifications" checked>
                <span class="settings-switch-slider"></span>
              </label>
            </div>
            <div class="settings-option">
              <div class="settings-option-info">
                <span class="settings-option-label">Notificaciones de proyectos</span>
                <span class="settings-option-desc">Alertas sobre tus proyectos</span>
              </div>
              <label class="settings-switch">
                <input type="checkbox" id="projectNotifications" checked>
                <span class="settings-switch-slider"></span>
              </label>
            </div>
            <div class="settings-option">
              <div class="settings-option-info">
                <span class="settings-option-label">Notificaciones de comunidad</span>
                <span class="settings-option-desc">Comentarios y resenas</span>
              </div>
              <label class="settings-switch">
                <input type="checkbox" id="communityNotifications">
                <span class="settings-switch-slider"></span>
              </label>
            </div>
          </div>
        </div>

        <!-- Privacidad -->
        <div class="settings-card">
          <div class="settings-card-header">
            <div class="settings-card-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
              </svg>
            </div>
            <div class="settings-card-title">
              <h3>Privacidad</h3>
              <p>Controla la visibilidad de tu perfil</p>
            </div>
          </div>
          <div class="settings-card-content">
            <div class="settings-option">
              <div class="settings-option-info">
                <span class="settings-option-label">Perfil publico</span>
                <span class="settings-option-desc">Otros usuarios pueden ver tu perfil</span>
              </div>
              <label class="settings-switch">
                <input type="checkbox" id="publicProfile" checked>
                <span class="settings-switch-slider"></span>
              </label>
            </div>
            <div class="settings-option">
              <div class="settings-option-info">
                <span class="settings-option-label">Mostrar proyectos publicos</span>
                <span class="settings-option-desc">Tus proyectos aparecen en la comunidad</span>
              </div>
              <label class="settings-switch">
                <input type="checkbox" id="showPublicProjects" checked>
                <span class="settings-switch-slider"></span>
              </label>
            </div>
          </div>
        </div>

        <!-- Cuenta -->
        <div class="settings-card">
          <div class="settings-card-header">
            <div class="settings-card-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
              </svg>
            </div>
            <div class="settings-card-title">
              <h3>Cuenta</h3>
              <p>Gestiona tu informacion personal</p>
            </div>
          </div>
          <div class="settings-card-content">
            <div class="settings-option settings-option-button">
              <div class="settings-option-info">
                <span class="settings-option-label">Editar perfil</span>
                <span class="settings-option-desc">Actualiza tu nombre y avatar</span>
              </div>
              <button class="settings-btn settings-btn-secondary" onclick="window.location.href='account/index.html'">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                </svg>
                Editar
              </button>
            </div>
            <div class="settings-option settings-option-button">
              <div class="settings-option-info">
                <span class="settings-option-label">Cambiar contrasena</span>
                <span class="settings-option-desc">Actualiza tu contrasena de acceso</span>
              </div>
              <button class="settings-btn settings-btn-secondary" id="changePasswordBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                  <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
                Cambiar
              </button>
            </div>
          </div>
        </div>

        <!-- Datos y almacenamiento -->
        <div class="settings-card">
          <div class="settings-card-header">
            <div class="settings-card-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <ellipse cx="12" cy="5" rx="9" ry="3"/>
                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
              </svg>
            </div>
            <div class="settings-card-title">
              <h3>Datos y almacenamiento</h3>
              <p>Gestiona tus datos y exportaciones</p>
            </div>
          </div>
          <div class="settings-card-content">
            <div class="settings-option settings-option-button">
              <div class="settings-option-info">
                <span class="settings-option-label">Exportar datos</span>
                <span class="settings-option-desc">Descarga una copia de tus proyectos</span>
              </div>
              <button class="settings-btn settings-btn-primary" id="exportDataBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                  <polyline points="7 10 12 15 17 10"/>
                  <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                Exportar
              </button>
            </div>
            <div class="settings-option settings-option-button">
              <div class="settings-option-info">
                <span class="settings-option-label">Limpiar cache</span>
                <span class="settings-option-desc">Libera espacio eliminando datos temporales</span>
              </div>
              <button class="settings-btn settings-btn-secondary" id="clearCacheBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"/>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                </svg>
                Limpiar
              </button>
            </div>
          </div>
        </div>

        <!-- Zona de peligro -->
        <div class="settings-card settings-card-danger">
          <div class="settings-card-header">
            <div class="settings-card-icon settings-icon-danger">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                <line x1="12" y1="9" x2="12" y2="13"/>
                <line x1="12" y1="17" x2="12.01" y2="17"/>
              </svg>
            </div>
            <div class="settings-card-title">
              <h3>Zona de peligro</h3>
              <p>Acciones irreversibles</p>
            </div>
          </div>
          <div class="settings-card-content">
            <div class="settings-option settings-option-button">
              <div class="settings-option-info">
                <span class="settings-option-label">Eliminar cuenta</span>
                <span class="settings-option-desc">Esta accion eliminara permanentemente tu cuenta y todos tus datos</span>
              </div>
              <button class="settings-btn settings-btn-danger" id="deleteAccountBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"/>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                  <line x1="10" y1="11" x2="10" y2="17"/>
                  <line x1="14" y1="11" x2="14" y2="17"/>
                </svg>
                Eliminar cuenta
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Panel de Información del Proyecto -->
  <div id="projectPanel" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="panel-card" role="document">
      <button id="panelClose" class="panel-close" aria-label="Cerrar panel">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
      <div class="panel-top">
        <div class="panel-initials" id="panelInitials">--</div>
        <div class="panel-title">
          <h2 id="panelTitle">
            <span id="panelTitleText">Nombre del Proyecto</span>
            <button id="panelFavBtn" class="panel-fav-btn" title="Añadir a Favoritos">
              <svg id="panelFavIcon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
              </svg>
            </button>
          </h2>
          <div class="panel-meta">
            <span id="panelDate">hace poco</span>
          </div>
          <a id="panelVisit" class="btn-visit" href="#" target="_blank" rel="noopener">
            <span>Visitar web</span>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
              <polyline points="15 3 21 3 21 9"/>
              <line x1="10" y1="14" x2="21" y2="3"/>
            </svg>
          </a>
        </div>
      </div>
      <div class="panel-body">
        <div id="panelDescription" class="panel-description">Descripción del proyecto...</div>
        <div class="panel-divider" aria-hidden="true"></div>
        <div id="panelTags" class="panel-tags" aria-hidden="true"></div>
        <button id="panelEditBtn" class="panel-edit-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
          </svg>
          <span>Editar Proyecto</span>
        </button>
      </div>
    </div>
  </div>

  <script src="keys.js?v=4.0"></script>
  <!-- Modal de Planes de Suscripcion -->
  <div id="plansModal" class="plans-modal">
    <div class="plans-modal-overlay"></div>
    <div class="plans-modal-content">
      <button class="plans-modal-close" id="plansModalClose">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
      
      <div class="plans-modal-header">
        <h2 class="plans-modal-title">Elige tu Plan</h2>
        <p class="plans-modal-subtitle">Selecciona el plan que mejor se adapte a tus necesidades</p>
      </div>
      
      <div class="plans-grid">
        <!-- Plan Normal (Gratis) -->
        <div class="plan-card plan-normal" data-plan="0">
          <div class="plan-badge plan-badge-free">Gratis</div>
          <h3 class="plan-name">Normal</h3>
          <div class="plan-price">
            <span class="plan-price-amount">$0</span>
            <span class="plan-price-currency">MXN</span>
          </div>
          
          <ul class="plan-features">
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
              <span><strong>10</strong> Apps</span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
              <span>Agent <strong>Flash</strong></span>
            </li>
            <li class="plan-feature plan-feature-disabled">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
              <span>Sin generacion de imagenes</span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
              <span>Instrucciones <strong>Largo</strong></span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
              <span>Programacion <strong>Uno por uno</strong></span>
            </li>
            <li class="plan-feature plan-feature-disabled">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
              <span>Sin equipos</span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
              <span>Soporte <strong>Limitado IA</strong></span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
              <span><strong>2</strong> Copias de seguridad</span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
              <span><strong>3</strong> Publicaciones</span>
            </li>
          </ul>
          
          <button id="planBtnNormal" class="plan-btn plan-btn-current" disabled>Plan Actual</button>
        </div>
        
        <!-- Plan Plus -->
        <div class="plan-card plan-plus" data-plan="1">
          <div class="plan-badge plan-badge-popular">Popular</div>
          <h3 class="plan-name">Plus</h3>
          <div class="plan-price">
            <span class="plan-price-amount">$126</span>
            <span class="plan-price-currency">MXN</span>
            <span class="plan-price-period">/mes</span>
          </div>
          
          <ul class="plan-features">
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
              <span><strong>15</strong> Apps</span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
              <span>Agent <strong>Pro</strong></span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
              <span><strong>5</strong> Generacion de imagenes</span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
              <span>Instrucciones <strong>Largo Especifico</strong></span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
              <span>Programacion <strong>All (Todo)</strong></span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
              <span>Equipos <strong>2 Personas</strong></span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
              <span>Soporte <strong>24/7</strong></span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
              <span><strong>10</strong> Copias de seguridad</span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
              <span><strong>7</strong> Publicaciones</span>
            </li>
          </ul>
          
          <button id="planBtnPlus" class="plan-btn plan-btn-upgrade">Mejorar a Plus</button>
        </div>
        
        <!-- Plan Ultimate -->
        <div class="plan-card plan-ultimate" data-plan="3">
          <div class="plan-badge plan-badge-ultimate">Premium</div>
          <h3 class="plan-name">Ultimate</h3>
          <div class="plan-price">
            <span class="plan-price-amount">$450</span>
            <span class="plan-price-currency">MXN</span>
            <span class="plan-price-period">/mes</span>
          </div>
          
          <ul class="plan-features">
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
              <span><strong>30</strong> Apps</span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
              <span>Agent <strong>Pro</strong></span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
              <span><strong>15</strong> Generacion de imagenes</span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
              <span>Instrucciones <strong>Ultra Largo</strong></span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
              <span>Programacion <strong>All (Todo)</strong></span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
              <span>Equipos <strong>10 Personas</strong></span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
              <span>Soporte <strong>24/7 Code Assistance</strong></span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
              <span><strong>20</strong> Copias de seguridad</span>
            </li>
            <li class="plan-feature">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
              <span><strong>25</strong> Publicaciones</span>
            </li>
          </ul>
          
          <button id="planBtnUltimate" class="plan-btn plan-btn-premium">Mejorar a Ultimate</button>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="script.js?v=4.0"></script>
  <script>
    // Configurar funcionalidad del sidebar
    document.addEventListener('DOMContentLoaded', () => {
      const sidebar = document.getElementById('mainSidebar');
      const mainContent = document.querySelector('.main-content');
      const sidebarCollapsedControls = document.getElementById('sidebarCollapsedControls');
      const sidebarOpenBtn = document.getElementById('sidebarOpenBtn');
      const searchBtn = document.querySelector('.search-btn');
      const optionsBtn = document.getElementById('optionsBtn');
      const optionsMenu = document.getElementById('optionsMenu');

      // Función para cerrar el sidebar
      function closeSidebar() {
        sidebar.classList.add('sidebar-hidden');
        mainContent.classList.add('sidebar-hidden');
        sidebarCollapsedControls.style.display = 'flex';
      }

      // Función para abrir el sidebar
      function openSidebar() {
        sidebar.classList.remove('sidebar-hidden');
        mainContent.classList.remove('sidebar-hidden');
        sidebarCollapsedControls.style.display = 'none';
        optionsMenu.classList.remove('active');
      }

      // Cerrar sidebar por defecto en móvil
      if (window.innerWidth <= 768) {
        closeSidebar();
      }

      // Botón de búsqueda (ahora cierra el sidebar)
      if (searchBtn) {
        searchBtn.addEventListener('click', closeSidebar);
      }

      // Botón para abrir el sidebar
      if (sidebarOpenBtn) {
        sidebarOpenBtn.addEventListener('click', openSidebar);
      }

      // Botón de opciones - redirige a account
      if (optionsBtn) {
        optionsBtn.addEventListener('click', (e) => {
          e.preventDefault();
          window.location.href = '/account';
        });
      }

      // Funcionalidad del menú de opciones
      const optionsMenuAccount = document.getElementById('optionsMenuAccount');
      const optionsMenuHelp = document.getElementById('optionsMenuHelp');
      const optionsMenuLogout = document.getElementById('optionsMenuLogout');
      const optionsThemeIcons = document.querySelectorAll('#optionsMenu .theme-icon');

      if (optionsMenuAccount) {
        optionsMenuAccount.addEventListener('click', () => {
          window.location.href = '/account';
          optionsMenu.classList.remove('active');
        });
      }

      if (optionsMenuHelp) {
        optionsMenuHelp.addEventListener('click', () => {
          window.open('https://github.com/DevCenterX-Agent/docs', '_blank');
          optionsMenu.classList.remove('active');
        });
      }

      if (optionsMenuLogout) {
        optionsMenuLogout.addEventListener('click', async () => {
          const localUser = localStorage.getItem('devcenter_user');
          const localUserId = localStorage.getItem('devcenter_user_id');
          const { data: { session } } = await window.supabaseClient.auth.getSession();
          
          if (localUser && localUserId) {
            if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
              localStorage.removeItem('devcenter_user');
              localStorage.removeItem('devcenter_user_id');
              localStorage.removeItem('devcenter_email');
              localStorage.removeItem('devcenter_avatar');
              localStorage.removeItem('devcenter_datos');
              localStorage.removeItem('devcenter_login_time');
              localStorage.removeItem('supabase_nombrepersona');
              console.log('✅ Sesión de tabla cuentas cerrada');
              window.location.href = '/';
            }
          } else if (session?.user) {
            if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
              try {
                await window.supabaseClient.auth.signOut();
                console.log('✅ Sesión de Supabase cerrada');
                window.location.href = '/';
              } catch (error) {
                console.error('Error al cerrar sesión en Supabase:', error);
                alert('Error al cerrar sesión. Intenta de nuevo.');
              }
            }
          } else {
            alert('No hay ninguna sesión activa.');
          }
          optionsMenu.classList.remove('active');
        });
      }

      // Cambiar tema (menú de opciones)
      optionsThemeIcons.forEach(icon => {
        icon.addEventListener('click', (e) => {
          e.stopPropagation();
          const theme = icon.dataset.theme;
          alert(`Cambio de tema a ${theme} - Próximamente disponible`);
        });
      });

      // Configurar el menú del logo
      const logoBtn = document.getElementById('logoBtn');
      const logoMenu = document.getElementById('logoMenu');
      
      if (logoBtn && logoMenu) {
        logoBtn.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          logoMenu.classList.toggle('active');
        });

        // Cerrar menú al hacer clic fuera
        document.addEventListener('click', (e) => {
          if (!logoMenu.contains(e.target) && e.target !== logoBtn && !logoBtn.contains(e.target)) {
            logoMenu.classList.remove('active');
          }
        });
      }

      // Funcionalidad de los items del menú
      const menuAccount = document.getElementById('menuAccount');
      const menuHelp = document.getElementById('menuHelp');
      const menuLogout = document.getElementById('menuLogout');
      const themeIcons = document.querySelectorAll('.theme-icon');

      if (menuAccount) {
        menuAccount.addEventListener('click', () => {
          window.location.href = '/account';
          logoMenu.classList.remove('active');
        });
        
        // Actualizar el texto del botón Account si el usuario está logueado
        if (window.auth && window.auth.isLoggedIn()) {
          const currentUser = window.auth.getCurrentUser();
          const accountTextElement = document.getElementById('accountText');
          if (accountTextElement && currentUser) {
            accountTextElement.textContent = currentUser.username || currentUser.email || 'Account';
          }
        }
      }

      if (menuHelp) {
        menuHelp.addEventListener('click', () => {
          window.open('https://github.com/DevCenterX-Agent/docs', '_blank');
          logoMenu.classList.remove('active');
        });
      }

      if (menuLogout) {
        menuLogout.addEventListener('click', async () => {
          const localUser = localStorage.getItem('devcenter_user');
          const localUserId = localStorage.getItem('devcenter_user_id');
          const { data: { session } } = await window.supabaseClient.auth.getSession();
          
          if (localUser && localUserId) {
            if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
              localStorage.removeItem('devcenter_user');
              localStorage.removeItem('devcenter_user_id');
              localStorage.removeItem('devcenter_email');
              localStorage.removeItem('devcenter_avatar');
              localStorage.removeItem('devcenter_datos');
              localStorage.removeItem('devcenter_login_time');
              localStorage.removeItem('supabase_nombrepersona');
              console.log('✅ Sesión de tabla cuentas cerrada');
              window.location.href = '/';
            }
          } else if (session?.user) {
            if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
              try {
                await window.supabaseClient.auth.signOut();
                console.log('✅ Sesión de Supabase cerrada');
                window.location.href = '/';
              } catch (error) {
                console.error('Error al cerrar sesión en Supabase:', error);
                alert('Error al cerrar sesión. Intenta de nuevo.');
              }
            }
          } else {
            alert('No hay ninguna sesión activa.');
          }
          logoMenu.classList.remove('active');
        });
      }

      // Cambiar tema
      themeIcons.forEach(icon => {
        icon.addEventListener('click', (e) => {
          e.stopPropagation();
          const theme = icon.dataset.theme;
          alert(`Cambio de tema a ${theme} - Próximamente disponible`);
        });
      });
    });

    // Navegación entre secciones (estilo Replit)
    document.querySelectorAll('.nav-item[data-section]').forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        const section = item.dataset.section;
        
        // Actualizar estado activo
        document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
        item.classList.add('active');
        
        // Mostrar sección correspondiente
        document.querySelectorAll('.content-section').forEach(sec => sec.classList.remove('active'));
        const targetSection = document.getElementById(`${section}-section`);
        if (targetSection) {
          targetSection.classList.add('active');
        }
        
        // Cerrar sidebar automáticamente en móvil al cambiar de sección
        if (window.innerWidth <= 768) {
          const sidebar = document.getElementById('mainSidebar');
          const mainContent = document.querySelector('.main-content');
          const sidebarCollapsedControls = document.getElementById('sidebarCollapsedControls');
          if (sidebar && mainContent && sidebarCollapsedControls) {
            sidebar.classList.add('sidebar-hidden');
            mainContent.classList.add('sidebar-hidden');
            sidebarCollapsedControls.style.display = 'flex';
          }
        }
        
        // Cargar contenido específico de cada sección
        setTimeout(() => {
          if (section === 'apps' && typeof window.renderAllProjectsInAppsSection === 'function') {
            // Solo cargar si el grid está vacío o no se ha cargado aún
            const appsGrid = document.getElementById('appsGrid');
            
            // Verificar si ya hay proyectos cargados
            const hasContent = appsGrid && appsGrid.children.length > 0;
            
            if (!hasContent) {
              window.renderAllProjectsInAppsSection();
            } else {
              console.log('[Apps Cache] Sección Apps ya tiene contenido cargado, usando caché');
            }
          } else if (section === 'published' && typeof window.renderPublishedProjects === 'function') {
            window.renderPublishedProjects();
          }
        }, 50);
      });
    });

    // Funcionalidad de los botones principales
    document.addEventListener('DOMContentLoaded', () => {
      // Botón principal "Create App" del sidebar
      const mainCreateBtn = document.getElementById('mainCreateBtn');
      if (mainCreateBtn) {
        mainCreateBtn.addEventListener('click', () => {
          // Ir directamente a la página de crear app
          window.location.href = '/Programar/crear-app/index.html';
        });
      }

      // Actualizar saludo según si el usuario está registrado
      const greetingText = document.getElementById('greetingText');
      if (greetingText && window.auth) {
        // Diferentes mensajes de bienvenida
        const greetingsLoggedOut = [
          '¿Qué quieres crear hoy?',
          '¿Qué construimos hoy?',
          '¿En qué proyecto trabajamos hoy?',
          '¿Qué idea vamos a hacer realidad?',
          '¿Qué te gustaría desarrollar hoy?'
        ];
        
        const greetingsLoggedIn = [
          '¿qué quieres crear hoy?',
          '¿qué construimos hoy?',
          '¿en qué proyecto trabajamos hoy?',
          '¿qué idea hacemos realidad?',
          '¿qué desarrollamos hoy?'
        ];
        
        if (window.auth.isLoggedIn()) {
          const currentUser = window.auth.getCurrentUser();
          if (currentUser && currentUser.username) {
            // Seleccionar saludo aleatorio
            const randomGreeting = greetingsLoggedIn[Math.floor(Math.random() * greetingsLoggedIn.length)];
            greetingText.innerHTML = 'Hola <span class="username">' + currentUser.username + '</span>, ' + randomGreeting;
          }
        } else {
          // Seleccionar saludo aleatorio para usuarios no logueados
          const randomGreeting = greetingsLoggedOut[Math.floor(Math.random() * greetingsLoggedOut.length)];
          greetingText.textContent = randomGreeting;
        }
      }

      // Configurar el botón Start chat para redirigir a la IA
      const startChatBtn = document.getElementById('startChatBtn');
      const searchBox = document.getElementById('searchBox');
      
      if (startChatBtn && searchBox) {
        startChatBtn.addEventListener('click', () => {
          const message = searchBox.value.trim();
          // Redirigir a la página de crear app con el mensaje
          if (message) {
            window.location.href = '/Programar/crear-app/index.html?message=' + encodeURIComponent(message);
          } else {
            window.location.href = '/Programar/crear-app/index.html';
          }
        });

        // También permitir enviar con Enter
        searchBox.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            startChatBtn.click();
          }
        });
      }

      // Configurar el botón "Create First App" del estado vacío
      const createFirstAppBtn = document.getElementById('createFirstAppBtn');
      const emptyStateTitle = document.getElementById('emptyStateTitle');
      const emptyStateDescription = document.getElementById('emptyStateDescription');
      const createFirstAppBtnText = document.getElementById('createFirstAppBtnText');
      
      // Actualizar el estado vacío según si el usuario está logueado
      function updateEmptyState() {
        if (window.auth && window.auth.isLoggedIn()) {
          // Usuario logueado: mostrar mensaje normal
          if (emptyStateTitle) emptyStateTitle.textContent = 'No tienes apps todavía';
          if (emptyStateDescription) emptyStateDescription.textContent = 'Crea tu primera app para empezar';
          if (createFirstAppBtnText) createFirstAppBtnText.textContent = 'Create App';
        } else {
          // Usuario NO logueado: mostrar mensaje de login
          if (emptyStateTitle) emptyStateTitle.textContent = 'Inicia sesión para empezar a crear';
          if (emptyStateDescription) emptyStateDescription.textContent = 'Accede a tu cuenta para crear y gestionar tus apps';
          if (createFirstAppBtnText) createFirstAppBtnText.textContent = 'Iniciar Sesión';
        }
      }
      
      if (createFirstAppBtn) {
        // Actualizar el estado vacío al cargar la página
        updateEmptyState();
        
        createFirstAppBtn.addEventListener('click', () => {
          // Verificar si el usuario está logueado
          if (window.auth && window.auth.isLoggedIn()) {
            // Si está logueado, ir a la página de crear app
            window.location.href = '/Programar/crear-app/index.html';
          } else {
            // Si no está logueado, ir al login (DevCenterX Account)
            window.location.href = '/Creator/index.html';
          }
        });
      }
    });
  </script>

  <!-- Router Script -->
  <script>
    (function() {
      const sidebar = document.getElementById('mainSidebar');
      const mainContent = document.querySelector('.main-content');
      const sidebarCollapsedControls = document.getElementById('sidebarCollapsedControls');
      const optionsMenu = document.getElementById('optionsMenu');
      const sidebarOverlay = document.querySelector('.sidebar-overlay');
      
      function hideAll() {
        }
        }
        if (sidebar) sidebar.style.display = 'none';
        if (mainContent) mainContent.style.display = 'none';
        if (sidebarCollapsedControls) sidebarCollapsedControls.style.display = 'none';
        if (optionsMenu) optionsMenu.style.display = 'none';
      }
      
      function showLanding() {
        hideAll();
      }
      
      function showLogin() {
        hideAll();
        }
      }
      
      function showCreate() {
        hideAll();
        }
      }
      
      function showTerms() {
        const termsPage = document.getElementById('termsPage');
        if (termsPage) {
          termsPage.style.display = 'flex';
          setTimeout(() => termsPage.classList.add('active'), 10);
        }
      }
      
      function showPrivacy() {
        const privacyPage = document.getElementById('privacyPage');
        if (privacyPage) {
          privacyPage.style.display = 'flex';
          setTimeout(() => privacyPage.classList.add('active'), 10);
        }
      }
      
      function hideTerms() {
        const termsPage = document.getElementById('termsPage');
        if (termsPage) {
          termsPage.classList.remove('active');
          setTimeout(() => { termsPage.style.display = 'none'; }, 300);
        }
      }
      
      function hidePrivacy() {
        const privacyPage = document.getElementById('privacyPage');
        if (privacyPage) {
          privacyPage.classList.remove('active');
          setTimeout(() => { privacyPage.style.display = 'none'; }, 300);
        }
      }
      
      window.closeLegalModal = function() {
        hideTerms();
        hidePrivacy();
        history.back();
      };
      
      function showMainApp() {
        hideAll();
        if (sidebar) sidebar.style.display = 'flex';
        if (mainContent) mainContent.style.display = 'block';
        if (sidebarOverlay) sidebarOverlay.style.display = '';
      }
      
      async function navigate() {
        const hash = window.location.hash;
        
        // Verificar sesión desde localStorage (tabla 'cuentas')
        const localUser = localStorage.getItem('devcenter_user');
        if (localUser) {
          console.log('Sesion activa desde tabla cuentas:', localUser);
          window.isLoggedIn = true;
          
          // Inicializar usuario en Supabase personas si es necesario
          if (window.supabaseClient) {
            try {
              const { data: persona } = await window.supabaseClient
                .from('personas')
                .select('*')
                .eq('nombrepersona', localUser)
                .maybeSingle();
              
              if (persona) {
                window.currentSupabaseUser = persona;
                localStorage.setItem('supabase_nombrepersona', localUser);
              }
            } catch (e) {
              console.log('Error cargando persona:', e);
            }
          }
          
          showMainApp();
          return;
        }
        
        // Verificar sesión de Supabase Auth (respaldo para OAuth)
        if (window.supabaseClient) {
          try {
            const { data: { session } } = await window.supabaseClient.auth.getSession();
            if (session?.user) {
              window.isLoggedIn = true;
              showMainApp();
              return;
            }
          } catch (e) {
            console.log('Error verificando sesión:', e);
          }
        }
        
        if (!window.isLoggedIn) {
        window.location.href = "/new.html";
      } else {
          showMainApp();
          return;
        }
        
        switch(hash) {
          case '#login':
            showLogin();
            break;
          case '#create':
            showCreate();
            break;
          case '#terms':
            showTerms();
            return;
          case '#privacy':
            showPrivacy();
            return;
          default:
            hideTerms();
            hidePrivacy();
            showLanding();
        }
      }
      
      window.addEventListener('hashchange', navigate);
      navigate();
      
      // ==========================================
      // SUPABASE AUTH - Login con email/password y proveedores sociales
      // Esperar a que Supabase esté listo
      // ==========================================
      function waitForSupabase(callback, maxAttempts = 100) {
        // Si ya está disponible, ejecutar inmediatamente
        if (window.supabaseClient) {
          callback(window.supabaseClient);
          return;
        }
        
        let resolved = false;
        
        // Escuchar evento personalizado
        const handleEvent = (e) => {
          if (!resolved) {
            resolved = true;
            window.removeEventListener('supabaseReady', handleEvent);
            callback(e.detail?.client || window.supabaseClient);
          }
        };
        window.addEventListener('supabaseReady', handleEvent);
        
        // Fallback: polling con más intentos
        let attempts = 0;
        const check = () => {
          if (resolved) return;
          attempts++;
          if (window.supabaseClient) {
            resolved = true;
            window.removeEventListener('supabaseReady', handleEvent);
            callback(window.supabaseClient);
          } else if (attempts < maxAttempts) {
            setTimeout(check, 100);
          } else {
            console.error('Supabase client no disponible después de esperar 10 segundos');
          }
        };
        setTimeout(check, 100);
      }
      
      waitForSupabase((authSupabase) => {
        console.log('Supabase Auth inicializado para login/signup');
        
        // Función auxiliar para generar username unico
        async function generateUniqueUsername(baseUsername, supabaseClient) {
          let finalUsername = baseUsername;
          let attempts = 0;
          const maxAttempts = 5;
          
          while (attempts < maxAttempts) {
            const { data: existingUser } = await supabaseClient
              .from('cuentas')
              .select('usuario')
              .eq('usuario', finalUsername)
              .maybeSingle();
            
            if (!existingUser) {
              return finalUsername;
            }
            
            attempts++;
            finalUsername = baseUsername + Math.floor(Math.random() * 9999);
          }
          
          return baseUsername + '_' + Date.now();
        }
        
        // Función para procesar usuario OAuth y crear/actualizar cuenta
        async function processOAuthUser(session) {
          if (!session?.user) return false;
          
          console.log('✅ Usuario OAuth autenticado:', session.user.email);
          console.log('📋 Provider:', session.user.app_metadata?.provider);
          console.log('📋 User ID (auth.users):', session.user.id);
          
          const authUserId = session.user.id;
          const email = session.user.email || '';
          const provider = session.user.app_metadata?.provider || 'oauth';
          let baseUsername = session.user.user_metadata?.preferred_username || 
                         session.user.user_metadata?.user_name ||
                         session.user.user_metadata?.name ||
                         session.user.user_metadata?.full_name?.replace(/\s+/g, '') ||
                         email.split('@')[0].replace(/[^a-zA-Z0-9]/g, '') || 
                         'user' + Date.now();
          
          const avatar = session.user.user_metadata?.avatar_url || 
                        session.user.user_metadata?.picture || '';
          
          const fullName = session.user.user_metadata?.full_name || 
                          session.user.user_metadata?.name || baseUsername;
          
          let savedUsername = baseUsername;
          let accountSaved = false;
          let personaSaved = false;
          
          try {
            // 1. Verificar/Crear en tabla cuentas
            console.log('🔍 Verificando tabla cuentas...');
            const { data: existingAccount, error: searchError } = await authSupabase
              .from('cuentas')
              .select('*')
              .eq('email', email)
              .maybeSingle();
            
            if (searchError && searchError.code !== 'PGRST116') {
              console.log('⚠️ Error buscando en cuentas:', searchError.message);
            }
            
            if (existingAccount) {
              console.log('✅ Cuenta existente encontrada en cuentas:', existingAccount.usuario);
              savedUsername = existingAccount.usuario;
              accountSaved = true;
              
              localStorage.setItem('devcenter_user', existingAccount.usuario);
              localStorage.setItem('devcenter_user_id', existingAccount.id);
              localStorage.setItem('devcenter_auth_user_id', authUserId);
              localStorage.setItem('devcenter_email', existingAccount.email);
              localStorage.setItem('devcenter_login_time', new Date().toISOString());
              localStorage.setItem('supabase_nombrepersona', existingAccount.usuario);
              localStorage.setItem('devcenter_provider', provider);
              if (existingAccount.avatar) localStorage.setItem('devcenter_avatar', existingAccount.avatar);
            } else {
              // Generar username unico antes de insertar
              const uniqueUsername = await generateUniqueUsername(savedUsername, authSupabase);
              console.log('📝 Creando nueva cuenta en tabla cuentas para:', uniqueUsername);
              
              const insertData = {
                usuario: uniqueUsername,
                email: email,
                contrasena: '',
                avatar: avatar,
                datos: JSON.stringify({ 
                  provider: provider, 
                  auth_id: authUserId,
                  full_name: fullName,
                  created_via: 'oauth'
                })
              };
              console.log('📤 Datos a insertar en cuentas:', insertData);
              
              const { data: nuevaCuenta, error: insertError } = await authSupabase
                .from('cuentas')
                .insert([insertData])
                .select()
                .single();
              
              if (insertError) {
                console.error('❌ Error creando en cuentas:', insertError);
                console.error('Código:', insertError.code, 'Mensaje:', insertError.message);
              } else {
                console.log('✅ Cuenta creada exitosamente en cuentas:', nuevaCuenta);
                savedUsername = uniqueUsername;
                accountSaved = true;
                
                localStorage.setItem('devcenter_user', uniqueUsername);
                localStorage.setItem('devcenter_user_id', nuevaCuenta.id);
                localStorage.setItem('devcenter_auth_user_id', authUserId);
                localStorage.setItem('devcenter_email', email);
                localStorage.setItem('devcenter_login_time', new Date().toISOString());
                localStorage.setItem('supabase_nombrepersona', uniqueUsername);
                localStorage.setItem('devcenter_provider', provider);
                if (avatar) localStorage.setItem('devcenter_avatar', avatar);
              }
            }
            
            // 2. Verificar/Crear en tabla personas (para proyectos)
            console.log('🔍 Verificando tabla personas...');
            const { data: existingPersona, error: personaSearchError } = await authSupabase
              .from('personas')
              .select('*')
              .eq('nombrepersona', savedUsername)
              .maybeSingle();
            
            if (personaSearchError && personaSearchError.code !== 'PGRST116') {
              console.log('⚠️ Error buscando en personas:', personaSearchError.message);
            }
            
            if (existingPersona) {
              console.log('✅ Usuario ya existe en personas:', existingPersona.nombrepersona);
              window.currentSupabaseUser = existingPersona;
              personaSaved = true;
            } else {
              console.log('📝 Creando registro en tabla personas...');
              const { data: newPersona, error: personaInsertError } = await authSupabase
                .from('personas')
                .insert([{
                  nombrepersona: savedUsername,
                  limite: 0,
                  status: 0,
                  proyectos: []
                }])
                .select()
                .single();
              
              if (personaInsertError) {
                console.log('⚠️ No se pudo crear en personas:', personaInsertError.message);
              } else {
                console.log('✅ Registro creado en personas:', newPersona);
                window.currentSupabaseUser = newPersona;
                personaSaved = true;
              }
            }
            
            // Siempre guardar en localStorage para permitir el acceso
            if (!accountSaved) {
              localStorage.setItem('devcenter_user', savedUsername);
              localStorage.setItem('devcenter_auth_user_id', authUserId);
              localStorage.setItem('devcenter_email', email);
              localStorage.setItem('devcenter_login_time', new Date().toISOString());
              localStorage.setItem('supabase_nombrepersona', savedUsername);
              localStorage.setItem('devcenter_provider', provider);
              if (avatar) localStorage.setItem('devcenter_avatar', avatar);
            }
            
            window.isLoggedIn = true;
            console.log('🎉 Proceso OAuth completado para:', savedUsername, '| Cuenta guardada:', accountSaved, '| Persona guardada:', personaSaved);
            return true;
          } catch (e) {
            console.error('❌ Error procesando usuario OAuth:', e);
            localStorage.setItem('devcenter_user', savedUsername);
            localStorage.setItem('devcenter_email', email);
            localStorage.setItem('devcenter_auth_user_id', authUserId);
            localStorage.setItem('devcenter_login_time', new Date().toISOString());
            localStorage.setItem('supabase_nombrepersona', savedUsername);
            window.isLoggedIn = true;
            return true;
          }
        }
        
        // Detectar si es un callback de OAuth (tiene access_token en el hash)
        const hashParams = new URLSearchParams(window.location.hash.substring(1));
        const isOAuthCallback = hashParams.has('access_token');
        
        if (isOAuthCallback) {
          console.log('🔑 Detectado callback de OAuth, procesando sesión...');
        }
        
        // Escuchar cambios de autenticación (más confiable para OAuth)
        authSupabase.auth.onAuthStateChange(async (event, session) => {
          console.log('🔔 Auth State Change:', event, session ? 'Con sesión' : 'Sin sesión');
          
          if (event === 'SIGNED_IN' && session) {
            const processed = await processOAuthUser(session);
            if (processed) {
              // Limpiar el hash de la URL
              if (window.location.hash.includes('access_token')) {
                window.history.replaceState(null, '', '/');
              }
              showMainApp();
            }
          }
        });
        
        // También verificar sesión existente
        (async () => {
          try {
            const { data: { session }, error } = await authSupabase.auth.getSession();
            console.log('🔍 Verificando sesión de Supabase Auth:', session ? 'Sesión encontrada' : 'Sin sesión');
            
            if (error) {
              console.error('Error obteniendo sesión:', error);
            }
            
            if (session?.user) {
              const processed = await processOAuthUser(session);
              if (processed) {
                if (isOAuthCallback) {
                  window.history.replaceState(null, '', '/');
                }
                showMainApp();
              }
            } else {
              console.log('ℹ️ No hay sesión activa de Supabase');
            }
          } catch (e) {
            console.error('Error verificando sesión:', e);
          }
        })();
      
      // Función para mostrar mensajes de error/éxito como toast
      function showAuthMessage(container, message, type = 'error') {
        console.log('showAuthMessage llamado:', message, type);
        
        // Siempre usar el toast propio para mayor control
        let toast = document.getElementById('auth-toast');
        if (!toast) {
          toast = document.createElement('div');
          toast.id = 'auth-toast';
          toast.className = 'auth-toast';
          document.body.appendChild(toast);
          console.log('Toast creado');
        }
        
        // Remover clase show primero para reiniciar animación
        toast.classList.remove('show');
        toast.className = 'auth-toast';
        
        // Forzar reflow para reiniciar animación
        void toast.offsetWidth;
        
        toast.textContent = message;
        toast.className = 'auth-toast ' + type + ' show';
        console.log('Toast mostrado con clase:', toast.className);
        
        setTimeout(() => { 
          toast.classList.remove('show'); 
        }, 4000);
      }
      
      function clearAuthMessage(container) {
        // Ya no se necesita limpiar porque usamos toasts
      }
      
      // Toggle mostrar formulario de email
      const showEmailLoginBtn = document.getElementById('showEmailLoginBtn');
      const loginFormEl = document.getElementById('loginForm');
      if (showEmailLoginBtn && loginFormEl) {
        showEmailLoginBtn.addEventListener('click', () => {
          const isVisible = loginFormEl.style.display !== 'none';
          loginFormEl.style.display = isVisible ? 'none' : 'block';
          showEmailLoginBtn.style.display = isVisible ? 'flex' : 'none';
        });
      }
      
      const showEmailSignupBtn = document.getElementById('showEmailSignupBtn');
      const createFormEl = document.getElementById('createForm');
      if (showEmailSignupBtn && createFormEl) {
        showEmailSignupBtn.addEventListener('click', () => {
          const isVisible = createFormEl.style.display !== 'none';
          createFormEl.style.display = isVisible ? 'none' : 'block';
          showEmailSignupBtn.style.display = isVisible ? 'flex' : 'none';
        });
      }
      
      // Password visibility toggle
      document.querySelectorAll('.password-toggle-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const targetId = btn.dataset.target;
          const input = document.getElementById(targetId);
          const eyeOpen = btn.querySelector('.eye-open');
          const eyeClosed = btn.querySelector('.eye-closed');
          
          if (input.type === 'password') {
            input.type = 'text';
            eyeOpen.style.display = 'none';
            eyeClosed.style.display = 'block';
          } else {
            input.type = 'password';
            eyeOpen.style.display = 'block';
            eyeClosed.style.display = 'none';
          }
        });
      });
      
      // Password strength checker
      const createPasswordInput = document.getElementById('createPassword');
      const strengthContainer = document.getElementById('passwordStrength');
      const strengthFill = document.getElementById('strengthFill');
      const strengthText = document.getElementById('strengthText');
      
      if (createPasswordInput && strengthContainer) {
        createPasswordInput.addEventListener('input', () => {
          const password = createPasswordInput.value;
          if (password.length === 0) {
            strengthContainer.style.display = 'none';
            return;
          }
          
          strengthContainer.style.display = 'flex';
          let strength = 0;
          let label = '';
          
          if (password.length >= 6) strength++;
          if (password.length >= 8) strength++;
          if (/[A-Z]/.test(password)) strength++;
          if (/[0-9]/.test(password)) strength++;
          if (/[^A-Za-z0-9]/.test(password)) strength++;
          
          strengthFill.className = 'strength-fill';
          strengthText.className = 'strength-text';
          
          if (strength <= 1) {
            label = 'Debil';
            strengthFill.classList.add('weak');
            strengthText.classList.add('weak');
          } else if (strength === 2) {
            label = 'Regular';
            strengthFill.classList.add('fair');
            strengthText.classList.add('fair');
          } else if (strength === 3) {
            label = 'Buena';
            strengthFill.classList.add('good');
            strengthText.classList.add('good');
          } else {
            label = 'Fuerte';
            strengthFill.classList.add('strong');
            strengthText.classList.add('strong');
          }
          
          strengthText.textContent = label;
        });
      }
      
      // Login con email/password - Usando tabla 'cuentas'
      if (loginFormEl) {
        loginFormEl.addEventListener('submit', async (e) => {
          e.preventDefault();
          const emailOrUser = document.getElementById('loginEmail').value.trim();
          const password = document.getElementById('loginPassword').value;
          const submitBtn = loginFormEl.querySelector('.split-submit-btn');
          
          if (!emailOrUser || !password) {
            showAuthMessage(container, 'Por favor completa todos los campos');
            return;
          }
          
          submitBtn.disabled = true;
          submitBtn.textContent = 'Iniciando sesion...';
          clearAuthMessage(container);
          
          try {
            // Buscar usuario por email O por nombre de usuario
            const isEmail = emailOrUser.includes('@');
            let cuenta = null;
            
            if (isEmail) {
              const { data, error } = await authSupabase
                .from('cuentas')
                .select('*')
                .eq('email', emailOrUser)
                .maybeSingle();
              if (error) throw new Error('Error al buscar cuenta');
              cuenta = data;
            } else {
              const { data, error } = await authSupabase
                .from('cuentas')
                .select('*')
                .eq('usuario', emailOrUser)
                .maybeSingle();
              if (error) throw new Error('Error al buscar cuenta');
              cuenta = data;
            }
            
            if (!cuenta) {
              throw new Error('no_existe');
            }
            
            // Verificar contrasena
            if (cuenta.contrasena !== password) {
              throw new Error('contrasena_incorrecta');
            }
            
            // Guardar sesion en localStorage
            localStorage.setItem('devcenter_user', cuenta.usuario);
            localStorage.setItem('devcenter_user_id', cuenta.id);
            localStorage.setItem('devcenter_email', cuenta.email);
            localStorage.setItem('devcenter_login_time', new Date().toISOString());
            if (cuenta.avatar) localStorage.setItem('devcenter_avatar', cuenta.avatar);
            if (cuenta.datos) localStorage.setItem('devcenter_datos', JSON.stringify(cuenta.datos));
            
            // Crear/actualizar registro en personas para compatibilidad
            const { data: existingPersona } = await authSupabase
              .from('personas')
              .select('id')
              .eq('nombrepersona', cuenta.usuario)
              .maybeSingle();
            
            if (!existingPersona) {
              await authSupabase.from('personas').insert([{
                nombrepersona: cuenta.usuario,
                limite: 0,
                status: 0,
                proyectos: []
              }]);
            }
            
            showAuthMessage(container, 'Bienvenido ' + cuenta.usuario + '! Redirigiendo...', 'success');
            
            setTimeout(() => {
              window.location.href = '/';
            }, 1000);
          } catch (error) {
            if (error.message === 'no_existe') {
              showAuthMessage(container, 'Cuenta no encontrada. Verifica tu email o usuario.');
            } else if (error.message === 'contrasena_incorrecta') {
              showAuthMessage(container, 'Contraseña incorrecta. Intenta de nuevo.');
            } else {
              showAuthMessage(container, error.message);
            }
          } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Iniciar sesion';
          }
        });
      }
      
      // Registro con email/password - Usando tabla 'cuentas'
      if (createFormEl) {
        createFormEl.addEventListener('submit', async (e) => {
          e.preventDefault();
          const email = document.getElementById('createEmail').value.trim();
          const password = document.getElementById('createPassword').value;
          const submitBtn = createFormEl.querySelector('.split-submit-btn');
          
          if (!email || !password) {
            showAuthMessage(container, 'Por favor completa todos los campos');
            return;
          }
          
          if (password.length < 6) {
            showAuthMessage(container, 'La contrasena debe tener al menos 6 caracteres');
            return;
          }
          
          submitBtn.disabled = true;
          submitBtn.textContent = 'Creando cuenta...';
          clearAuthMessage(container);
          
          try {
            // Generar username desde email
            const username = email.split('@')[0].replace(/[^a-zA-Z0-9]/g, '');
            
            // Verificar si email ya existe en 'cuentas'
            const { data: existingEmail } = await authSupabase
              .from('cuentas')
              .select('email')
              .eq('email', email)
              .maybeSingle();
            
            if (existingEmail) {
              throw new Error('email_existe');
            }
            
            // Verificar si username ya existe en 'cuentas'
            const { data: existingUser } = await authSupabase
              .from('cuentas')
              .select('usuario')
              .eq('usuario', username)
              .maybeSingle();
            
            const finalUsername = existingUser ? username + Math.floor(Math.random() * 1000) : username;
            
            // Crear registro en tabla 'cuentas'
            const { data: nuevaCuenta, error: insertError } = await authSupabase
              .from('cuentas')
              .insert([{
                usuario: finalUsername,
                email: email,
                contrasena: password,
                avatar: '',
                datos: {}
              }])
              .select()
              .single();
            
            if (insertError) {
              console.error('Error creando cuenta:', insertError);
              throw new Error('Error al crear la cuenta: ' + insertError.message);
            }
            
            // Guardar sesion en localStorage
            localStorage.setItem('devcenter_user', finalUsername);
            localStorage.setItem('devcenter_user_id', nuevaCuenta.id);
            localStorage.setItem('devcenter_email', email);
            localStorage.setItem('devcenter_login_time', new Date().toISOString());
            
            // Crear registro en personas para compatibilidad
            await authSupabase.from('personas').insert([{
              nombrepersona: finalUsername,
              limite: 0,
              status: 0,
              proyectos: []
            }]);
            
            // Guardar flag de onboarding pendiente
            localStorage.setItem('devcenter_onboarding_pending', 'true');
            
            showAuthMessage(container, 'Cuenta creada! Configuremos tu perfil...', 'success');
            setTimeout(() => {
              startOnboarding(finalUsername);
            }, 1000);
          } catch (error) {
            if (error.message === 'email_existe') {
              showAuthMessage(container, 'Este email ya tiene cuenta. Por favor inicia sesion.');
            } else {
              showAuthMessage(container, error.message);
            }
          } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Crear cuenta';
          }
        });
      }
      
      // Login con Google
      const googleLoginBtn = document.getElementById('googleLoginBtn');
      const googleSignupBtn = document.getElementById('googleSignupBtn');
      
      async function handleGoogleAuth() {
        try {
          const { data, error } = await authSupabase.auth.signInWithOAuth({
            provider: 'google',
            options: {
              redirectTo: window.location.origin + '/'
            }
          });
          if (error) throw error;
        } catch (error) {
          console.error('Error con Google Auth:', error);
          alert('Error al conectar con Google: ' + error.message);
        }
      }
      
      if (googleLoginBtn) googleLoginBtn.addEventListener('click', handleGoogleAuth);
      if (googleSignupBtn) googleSignupBtn.addEventListener('click', handleGoogleAuth);
      
      // Login con GitHub
      const githubLoginBtn = document.getElementById('githubLoginBtn');
      const githubSignupBtn = document.getElementById('githubSignupBtn');
      
      async function handleGitHubAuth() {
        try {
          const { data, error } = await authSupabase.auth.signInWithOAuth({
            provider: 'github',
            options: {
              redirectTo: window.location.origin + '/'
            }
          });
          if (error) throw error;
        } catch (error) {
          console.error('Error con GitHub Auth:', error);
          alert('Error al conectar con GitHub: ' + error.message);
        }
      }
      
      if (githubLoginBtn) githubLoginBtn.addEventListener('click', handleGitHubAuth);
      if (githubSignupBtn) githubSignupBtn.addEventListener('click', handleGitHubAuth);
      
      }); // Cierre de waitForSupabase callback
      
      const landingDemoBtn = document.getElementById('landingDemoBtn');
      if (landingDemoBtn) {
        landingDemoBtn.addEventListener('click', () => {
          localStorage.setItem('devcenter_user', 'Demo User');
          localStorage.setItem('devcenter_demo_mode', 'true');
          window.location.href = '/';
        });
      }
      
      document.querySelectorAll('.welcome-theme-toggle').forEach(btn => {
        btn.addEventListener('click', () => {
          const currentTheme = localStorage.getItem('theme') || 'dark';
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
          localStorage.setItem('theme', newTheme);
          document.documentElement.setAttribute('data-theme', newTheme);
          if (newTheme === 'light') {
            document.documentElement.classList.add('theme-light');
          } else {
            document.documentElement.classList.remove('theme-light');
          }
        });
      });
      
      const savedTheme = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', savedTheme);
      if (savedTheme === 'light') {
        document.documentElement.classList.add('theme-light');
      }
      
      // Animated Stats Counter
      const animateStats = () => {
        const statNumbers = document.querySelectorAll('.stat-number[data-target]');
        
        const animateNumber = (el) => {
          const target = parseInt(el.getAttribute('data-target'));
          const duration = 2000;
          const step = target / (duration / 16);
          let current = 0;
          
          const updateNumber = () => {
            current += step;
            if (current < target) {
              if (target >= 1000) {
                el.textContent = Math.floor(current).toLocaleString() + '+';
              } else {
                el.textContent = Math.floor(current) + '%';
              }
              requestAnimationFrame(updateNumber);
            } else {
              if (target >= 1000) {
                el.textContent = target.toLocaleString() + '+';
              } else {
                el.textContent = target + '%';
              }
            }
          };
          updateNumber();
        };
        
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              animateNumber(entry.target);
              observer.unobserve(entry.target);
            }
          });
        }, { threshold: 0.5 });
        
        statNumbers.forEach(stat => {
          stat.textContent = '0';
          observer.observe(stat);
        });
      };
      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', animateStats);
      } else {
        animateStats();
      }
      
      // ==================== MODAL DE PLANES ====================
      const plansModal = document.getElementById('plansModal');
      const plansModalClose = document.getElementById('plansModalClose');
      const plansModalOverlay = plansModal ? plansModal.querySelector('.plans-modal-overlay') : null;
      
      // Mapeo de status a plan: 0=Normal, 1=Plus, 3=Ultimate
      const planStatusMap = {
        0: 'normal',
        1: 'plus',
        3: 'ultimate'
      };
      
      function updatePlanButtons() {
        const planBtnNormal = document.getElementById('planBtnNormal');
        const planBtnPlus = document.getElementById('planBtnPlus');
        const planBtnUltimate = document.getElementById('planBtnUltimate');
        
        // Obtener el status del usuario desde currentSupabaseUser
        let userStatus = 0; // Default: plan Normal
        if (typeof currentSupabaseUser !== 'undefined' && currentSupabaseUser && currentSupabaseUser.status !== undefined) {
          userStatus = currentSupabaseUser.status;
        }
        
        const currentPlan = planStatusMap[userStatus] || 'normal';
        
        // Resetear todos los botones
        if (planBtnNormal) {
          planBtnNormal.className = 'plan-btn plan-btn-upgrade';
          planBtnNormal.disabled = false;
          planBtnNormal.textContent = 'Seleccionar';
        }
        if (planBtnPlus) {
          planBtnPlus.className = 'plan-btn plan-btn-upgrade';
          planBtnPlus.disabled = false;
          planBtnPlus.textContent = 'Mejorar a Plus';
        }
        if (planBtnUltimate) {
          planBtnUltimate.className = 'plan-btn plan-btn-premium';
          planBtnUltimate.disabled = false;
          planBtnUltimate.textContent = 'Mejorar a Ultimate';
        }
        
        // Marcar el plan actual
        if (currentPlan === 'normal' && planBtnNormal) {
          planBtnNormal.className = 'plan-btn plan-btn-current';
          planBtnNormal.disabled = true;
          planBtnNormal.textContent = 'Plan Actual';
        } else if (currentPlan === 'plus' && planBtnPlus) {
          planBtnPlus.className = 'plan-btn plan-btn-current';
          planBtnPlus.disabled = true;
          planBtnPlus.textContent = 'Plan Actual';
          // Si tiene Plus, puede bajar a Normal o subir a Ultimate
          if (planBtnNormal) {
            planBtnNormal.className = 'plan-btn plan-btn-upgrade';
            planBtnNormal.disabled = false;
            planBtnNormal.textContent = 'Cambiar a Normal';
          }
        } else if (currentPlan === 'ultimate' && planBtnUltimate) {
          planBtnUltimate.className = 'plan-btn plan-btn-current';
          planBtnUltimate.disabled = true;
          planBtnUltimate.textContent = 'Plan Actual';
          // Si tiene Ultimate, puede bajar a Plus o Normal
          if (planBtnPlus) {
            planBtnPlus.className = 'plan-btn plan-btn-upgrade';
            planBtnPlus.disabled = false;
            planBtnPlus.textContent = 'Cambiar a Plus';
          }
          if (planBtnNormal) {
            planBtnNormal.className = 'plan-btn plan-btn-upgrade';
            planBtnNormal.disabled = false;
            planBtnNormal.textContent = 'Cambiar a Normal';
          }
        }
      }
      
      function openPlansModal() {
        if (plansModal) {
          updatePlanButtons();
          plansModal.classList.add('active');
          document.body.style.overflow = 'hidden';
        }
      }
      
      function closePlansModal() {
        if (plansModal) {
          plansModal.classList.remove('active');
          document.body.style.overflow = '';
        }
      }
      
      // Cerrar modal con boton X
      if (plansModalClose) {
        plansModalClose.addEventListener('click', closePlansModal);
      }
      
      // Cerrar modal al hacer clic en el overlay
      if (plansModalOverlay) {
        plansModalOverlay.addEventListener('click', closePlansModal);
      }
      
      // Cerrar modal con tecla Escape
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && plansModal && plansModal.classList.contains('active')) {
          closePlansModal();
        }
      });
      
      // Conectar botones de Upgrade al modal
      document.querySelectorAll('.upgrade-btn, .usage-upgrade-btn').forEach(btn => {
        btn.addEventListener('click', openPlansModal);
      });
      
      // Hacer la funcion accesible globalmente
      window.openPlansModal = openPlansModal;
      window.updatePlanButtons = updatePlanButtons;
      
      // ==================== ONBOARDING SYSTEM ====================
      let onboardingData = {
        username: '',
        avatar: 'color-1',
        avatarImage: null,
        currentStep: 1
      };
      
      const avatarGradients = {
        'color-1': 'linear-gradient(135deg, #3b82f6, #1d4ed8)',
        'color-2': 'linear-gradient(135deg, #8b5cf6, #6d28d9)',
        'color-3': 'linear-gradient(135deg, #22c55e, #16a34a)',
        'color-4': 'linear-gradient(135deg, #f59e0b, #d97706)',
        'color-5': 'linear-gradient(135deg, #ef4444, #dc2626)',
        'color-6': 'linear-gradient(135deg, #ec4899, #db2777)',
        'color-7': 'linear-gradient(135deg, #14b8a6, #0d9488)',
        'color-8': 'linear-gradient(135deg, #6366f1, #4f46e5)'
      };
      
      // Guardar progreso del onboarding en localStorage
      function saveOnboardingProgress() {
        localStorage.setItem('onboarding_progress', JSON.stringify(onboardingData));
      }
      
      // Cargar progreso del onboarding desde localStorage
      function loadOnboardingProgress() {
        const saved = localStorage.getItem('onboarding_progress');
        if (saved) {
          try {
            const data = JSON.parse(saved);
            onboardingData = { ...onboardingData, ...data };
            return true;
          } catch (e) {
            console.error('Error cargando progreso de onboarding:', e);
          }
        }
        return false;
      }
      
      // Limpiar progreso del onboarding
      function clearOnboardingProgress() {
        localStorage.removeItem('onboarding_progress');
      }
      
      // Restaurar UI del onboarding segun el paso guardado
      function restoreOnboardingUI() {
        const initial = onboardingData.username ? onboardingData.username.charAt(0).toUpperCase() : 'U';
        
        // Configurar username input
        const usernameInput = document.getElementById('onboardingUsername');
        if (usernameInput && onboardingData.username) {
          usernameInput.value = onboardingData.username;
        }
        
        // Configurar iniciales en avatars
        document.querySelectorAll('.option-initial').forEach(el => {
          el.textContent = initial;
        });
        
        const avatarPreviewInitial = document.getElementById('avatarPreviewInitial');
        const avatarPreviewName = document.getElementById('avatarPreviewName');
        if (avatarPreviewInitial) avatarPreviewInitial.textContent = initial;
        if (avatarPreviewName) avatarPreviewName.textContent = '@' + (onboardingData.username || 'username');
        
        // Restaurar avatar seleccionado
        if (onboardingData.avatar && onboardingData.avatar !== 'custom') {
          document.querySelectorAll('.avatar-option-card').forEach(c => c.classList.remove('selected'));
          const selectedCard = document.querySelector(`.avatar-option-card[data-color="${onboardingData.avatar}"]`);
          if (selectedCard) {
            selectedCard.classList.add('selected');
            const preview = document.getElementById('avatarPreview');
            if (preview) {
              preview.style.background = avatarGradients[onboardingData.avatar];
              preview.innerHTML = '<span id="avatarPreviewInitial">' + initial + '</span>';
            }
          }
        }
        
        // Restaurar al paso correcto
        if (onboardingData.currentStep === 2) {
          document.getElementById('onboardingStep1').style.display = 'none';
          document.getElementById('onboardingStep2').style.display = 'block';
          
          // Actualizar indicador de progreso
          document.querySelector('.progress-step[data-step="1"]').classList.remove('active');
          document.querySelector('.progress-step[data-step="1"]').classList.add('completed');
          document.querySelector('.progress-step[data-step="2"]').classList.add('active');
          document.querySelector('.progress-line').classList.add('active');
        }
      }
      
      function startOnboarding(username, restoreFromStorage = false) {
        if (!restoreFromStorage) {
          onboardingData.username = username;
          onboardingData.currentStep = 1;
          saveOnboardingProgress();
        }
        
        const initial = onboardingData.username ? onboardingData.username.charAt(0).toUpperCase() : 'U';
        
        // Ocultar todas las otras paginas
        
        // Mostrar onboarding
        
        // Configurar username input con el valor actual
        const usernameInput = document.getElementById('onboardingUsername');
        if (usernameInput) {
          usernameInput.value = onboardingData.username || username;
        }
        
        // Configurar inicial en todos los avatars
        document.querySelectorAll('.option-initial').forEach(el => {
          el.textContent = initial;
        });
        document.getElementById('avatarPreviewInitial').textContent = initial;
        document.getElementById('avatarPreviewName').textContent = '@' + (onboardingData.username || username);
        
        // Si hay progreso guardado, restaurar UI
        if (restoreFromStorage) {
          restoreOnboardingUI();
        }
        
        // Cambiar hash a #config
        window.location.hash = 'config';
      }
      
      // Verificar si hay onboarding pendiente al cargar la pagina
      function checkPendingOnboarding() {
        const hasPendingOnboarding = localStorage.getItem('devcenter_onboarding_pending');
        const hasProgress = loadOnboardingProgress();
        
        if (hasPendingOnboarding && hasProgress && onboardingData.username) {
          // Hay onboarding pendiente, restaurar
          startOnboarding(onboardingData.username, true);
          return true;
        }
        return false;
      }
      
      // Verificar al cargar la pagina
      if (window.location.hash === '#config' || localStorage.getItem('devcenter_onboarding_pending')) {
        setTimeout(() => {
          checkPendingOnboarding();
        }, 100);
      }
      
      // Step 1: Username - Continue button
      const onboardingNextStep1 = document.getElementById('onboardingNextStep1');
      if (onboardingNextStep1) {
        onboardingNextStep1.addEventListener('click', () => {
          const usernameInput = document.getElementById('onboardingUsername');
          const usernameWrapper = usernameInput.closest('.username-input-wrapper');
          const newUsername = usernameInput.value.trim();
          
          if (!newUsername) {
            usernameWrapper.style.borderColor = '#ef4444';
            usernameWrapper.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.15)';
            usernameInput.focus();
            return;
          }
          
          // Limpiar estilos de error
          usernameWrapper.style.borderColor = '';
          usernameWrapper.style.boxShadow = '';
          
          // Actualizar el username con el nuevo valor
          onboardingData.username = newUsername;
          const initial = newUsername.charAt(0).toUpperCase();
          
          // Actualizar inicial en todos los avatars
          document.querySelectorAll('.option-initial').forEach(el => {
            el.textContent = initial;
          });
          document.getElementById('avatarPreviewInitial').textContent = initial;
          document.getElementById('avatarPreviewName').textContent = '@' + newUsername;
          
          // Pasar al paso 2
          document.getElementById('onboardingStep1').style.display = 'none';
          document.getElementById('onboardingStep2').style.display = 'block';
          
          // Actualizar indicador de progreso
          document.querySelector('.progress-step[data-step="1"]').classList.remove('active');
          document.querySelector('.progress-step[data-step="1"]').classList.add('completed');
          document.querySelector('.progress-step[data-step="2"]').classList.add('active');
          document.querySelector('.progress-line').classList.add('active');
          
          // Guardar progreso
          onboardingData.currentStep = 2;
          saveOnboardingProgress();
        });
      }
      
      // Limpiar error al escribir en el input de username
      const usernameInputEl = document.getElementById('onboardingUsername');
      if (usernameInputEl) {
        usernameInputEl.addEventListener('input', () => {
          const wrapper = usernameInputEl.closest('.username-input-wrapper');
          if (wrapper) {
            wrapper.style.borderColor = '';
            wrapper.style.boxShadow = '';
          }
        });
      }
      
      // Step 2: Back button
      const onboardingBackStep2 = document.getElementById('onboardingBackStep2');
      if (onboardingBackStep2) {
        onboardingBackStep2.addEventListener('click', () => {
          document.getElementById('onboardingStep2').style.display = 'none';
          document.getElementById('onboardingStep1').style.display = 'block';
          
          // Actualizar indicador de progreso
          document.querySelector('.progress-step[data-step="1"]').classList.add('active');
          document.querySelector('.progress-step[data-step="1"]').classList.remove('completed');
          document.querySelector('.progress-step[data-step="2"]').classList.remove('active');
          document.querySelector('.progress-line').classList.remove('active');
          
          // Guardar progreso
          onboardingData.currentStep = 1;
          saveOnboardingProgress();
        });
      }
      
      // Avatar selection
      document.querySelectorAll('.avatar-option-card').forEach(card => {
        card.addEventListener('click', () => {
          // Quitar seleccion de todos
          document.querySelectorAll('.avatar-option-card').forEach(c => c.classList.remove('selected'));
          // Seleccionar este
          card.classList.add('selected');
          
          const color = card.dataset.color;
          onboardingData.avatar = color;
          onboardingData.avatarImage = null;
          
          // Actualizar preview
          const preview = document.getElementById('avatarPreview');
          preview.style.background = avatarGradients[color];
          preview.innerHTML = '<span id="avatarPreviewInitial">' + onboardingData.username.charAt(0).toUpperCase() + '</span>';
          
          // Guardar progreso
          saveOnboardingProgress();
        });
      });
      
      // Avatar upload
      const avatarUpload = document.getElementById('avatarUpload');
      if (avatarUpload) {
        avatarUpload.addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (event) => {
              onboardingData.avatarImage = event.target.result;
              onboardingData.avatar = 'custom';
              
              // Quitar seleccion de colores
              document.querySelectorAll('.avatar-option-card').forEach(c => c.classList.remove('selected'));
              
              // Actualizar preview
              const preview = document.getElementById('avatarPreview');
              preview.style.background = 'none';
              preview.innerHTML = '<img src="' + event.target.result + '" alt="Avatar">';
              
              // Guardar progreso
              saveOnboardingProgress();
            };
            reader.readAsDataURL(file);
          }
        });
      }
      
      // Complete onboarding
      const onboardingComplete = document.getElementById('onboardingComplete');
      if (onboardingComplete) {
        onboardingComplete.addEventListener('click', async () => {
          onboardingComplete.disabled = true;
          onboardingComplete.innerHTML = 'Guardando...';
          
          try {
            // Esperar que Supabase este listo
            await waitForSupabase(async (supabase) => {
              const userId = localStorage.getItem('devcenter_user_id');
              
              // Actualizar cuenta con username y avatar
              const updateData = {
                usuario: onboardingData.username,
                avatar: onboardingData.avatar,
                datos: {
                  avatarImage: onboardingData.avatarImage
                }
              };
              
              const { error } = await supabase
                .from('cuentas')
                .update(updateData)
                .eq('id', userId);
              
              if (error) {
                console.error('Error guardando onboarding:', error);
              }
              
              // Guardar en localStorage
              localStorage.setItem('devcenter_user', onboardingData.username);
              localStorage.setItem('devcenter_avatar', onboardingData.avatar);
              if (onboardingData.avatarImage) {
                localStorage.setItem('devcenter_avatar_image', onboardingData.avatarImage);
              }
              localStorage.removeItem('devcenter_onboarding_pending');
              
              // Limpiar progreso de onboarding (completado)
              clearOnboardingProgress();
              
              // Limpiar hash
              window.location.hash = '';
              
              // Mostrar pantalla de carga
              document.getElementById('loadingScreen').style.display = 'flex';
              
              // Redirigir despues de 2 segundos
              setTimeout(() => {
                window.location.href = '/';
              }, 2500);
            });
          } catch (error) {
            console.error('Error en onboarding:', error);
            onboardingComplete.disabled = false;
            onboardingComplete.innerHTML = 'Completar <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>';
          }
        });
      }
      
      // Hacer funcion global
      window.startOnboarding = startOnboarding;
    })();
    
    // ==================== SETTINGS FUNCTIONALITY ====================
    (function initSettings() {
      // Theme toggle
      const themeDarkBtn = document.getElementById('themeDarkBtn');
      const themeLightBtn = document.getElementById('themeLightBtn');
      
      function setTheme(theme) {
        localStorage.setItem('devcenter_theme', theme);
        document.documentElement.setAttribute('data-theme', theme);
        
        // Update active state
        if (themeDarkBtn && themeLightBtn) {
          themeDarkBtn.classList.toggle('active', theme === 'dark');
          themeLightBtn.classList.toggle('active', theme === 'light');
        }
      }
      
      // Load saved theme
      const savedTheme = localStorage.getItem('devcenter_theme') || 'dark';
      setTheme(savedTheme);
      
      if (themeDarkBtn) {
        themeDarkBtn.addEventListener('click', () => setTheme('dark'));
      }
      if (themeLightBtn) {
        themeLightBtn.addEventListener('click', () => setTheme('light'));
      }
      
      // Load saved settings
      function loadSettings() {
        const settings = JSON.parse(localStorage.getItem('devcenter_settings') || '{}');
        
        const emailNotif = document.getElementById('emailNotifications');
        const projectNotif = document.getElementById('projectNotifications');
        const communityNotif = document.getElementById('communityNotifications');
        const publicProfile = document.getElementById('publicProfile');
        const showPublicProjects = document.getElementById('showPublicProjects');
        
        if (emailNotif) emailNotif.checked = settings.emailNotifications !== false;
        if (projectNotif) projectNotif.checked = settings.projectNotifications !== false;
        if (communityNotif) communityNotif.checked = settings.communityNotifications === true;
        if (publicProfile) publicProfile.checked = settings.publicProfile !== false;
        if (showPublicProjects) showPublicProjects.checked = settings.showPublicProjects !== false;
      }
      
      // Save settings on change
      function saveSettings() {
        const settings = {
          emailNotifications: document.getElementById('emailNotifications')?.checked,
          projectNotifications: document.getElementById('projectNotifications')?.checked,
          communityNotifications: document.getElementById('communityNotifications')?.checked,
          publicProfile: document.getElementById('publicProfile')?.checked,
          showPublicProjects: document.getElementById('showPublicProjects')?.checked
        };
        localStorage.setItem('devcenter_settings', JSON.stringify(settings));
      }
      
      // Add listeners to all settings toggles
      document.querySelectorAll('.settings-switch input').forEach(input => {
        input.addEventListener('change', saveSettings);
      });
      
      // Clear cache button
      const clearCacheBtn = document.getElementById('clearCacheBtn');
      if (clearCacheBtn) {
        clearCacheBtn.addEventListener('click', () => {
          localStorage.removeItem('devcenter_cache');
          sessionStorage.clear();
          alert('Cache limpiado correctamente');
        });
      }
      
      // Export data button
      const exportDataBtn = document.getElementById('exportDataBtn');
      if (exportDataBtn) {
        exportDataBtn.addEventListener('click', () => {
          const userData = localStorage.getItem('devcenter_user');
          const data = {
            user: userData,
            settings: JSON.parse(localStorage.getItem('devcenter_settings') || '{}'),
            exportDate: new Date().toISOString()
          };
          
          const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'devcenter-data.json';
          a.click();
          URL.revokeObjectURL(url);
        });
      }
      
      // Delete account button
      const deleteAccountBtn = document.getElementById('deleteAccountBtn');
      if (deleteAccountBtn) {
        deleteAccountBtn.addEventListener('click', () => {
          if (confirm('¿Estas seguro de que quieres eliminar tu cuenta? Esta accion no se puede deshacer.')) {
            if (confirm('Esta es tu ultima oportunidad. ¿Realmente quieres eliminar tu cuenta permanentemente?')) {
              alert('Para eliminar tu cuenta, por favor contacta a soporte.');
            }
          }
        });
      }
      
      // Load settings on page load
      loadSettings();
    })();
  </script>
</body>
</html>
